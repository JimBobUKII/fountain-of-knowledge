<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Connect to remote Docker over SSH | Fountain of Knowledge </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Connect to remote Docker over SSH | Fountain of Knowledge ">
    <meta name="generator" content="docfx 2.57.2.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="connect-to-remote-docker-over-ssh">Connect to remote Docker over SSH</h1>

<p>We recommend using the Visual Studio Code <a href="choosing-dev-environment.html#remote-machine">Remote-SSH extension</a> to connect to a remote machine running Docker engine, but it also possible to connect to the remote Docker engine directly, using SSH tunneling.</p>
<h2 id="set-up-ssh-tunneling">Set up SSH Tunneling</h2>
<ol>
<li><p>Use <a href="https://www.ssh.com/ssh/keygen">ssh-keygen</a> or similar to get and configure a public/private key pair for SSH authentication. Password authentication is not supported by Docker and not possible with a <code>DOCKER_HOST</code>-based configuration. If a key pair has already been set up, it can be used.</p>
</li>
<li><p>Configure <code>ssh-agent</code> on the <strong>local</strong> system with the <strong>private</strong> key file produced above.</p>
<ul>
<li><p><strong>Windows (OpenSSH):</strong> The latest version(s) of Windows 10 include OpenSSH by default. There is a Windows service, <code>ssh-agent</code> that is disabled by default, and needs to be re-enabled and set to automatic start. From an admin command prompt, run <code>sc config ssh-agent start=auto</code> and <code>net start ssh-agent</code>. Then, do <code>ssh-add &lt;keyfile&gt;</code>.</p>
</li>
<li><p><strong>Windows (Pageant):</strong> You can use Pageant instead of OpenSSH, in which case it is necessary to set the environment variable <code>SSH_AUTH_SOCK=pageant</code>. Making that a user or system environment variable will be easiest.</p>
</li>
<li><p><strong>Linux:</strong> <code>ssh-agent</code> is present by default. Do <code>ssh-add &lt;keyfile&gt;</code>. Ubuntu was tested; you might have different results on other distributions.</p>
</li>
<li><p><strong>macOS:</strong> <code>ssh-agent</code> is present by default, but <code>ssh-add</code> does not persist across logins. Do <code>ssh-add &lt;keyfile&gt;</code>. We recommend configuring VS Code to run this command on terminal startup with <code>terminal.integrated.shellArgs.osx</code> or otherwise configuring a startup script. You can also manually run that command each login.</p>
</li>
</ul>
</li>
<li><p>Verify that your identity is available to the agent with <code>ssh-add -l</code>. It should list one or more identities that look something like <code>2048 SHA256:abcdefghijk somethingsomething (RSA)</code>. If it does not list any identity, you will not be able to connect. Also, it needs to have the right identity. The Docker CLI working does not mean that the Explorer window will work. The Explorer window uses <a href="https://www.npmjs.com/package/dockerode">dockerode</a> (which in turn uses <a href="https://www.npmjs.com/package/ssh2">ssh2</a>), whereas the Docker CLI uses the <code>ssh</code> command, and benefits from an automatically inferred configuration.</p>
</li>
<li><p>Create a <a href="https://docs.docker.com/engine/context/working-with-contexts/">Docker context</a> that points to the remote machine running Docker. Use <code>ssh://username@host:port</code> as the Docker endpoint (replace &quot;host&quot; with your remote machine name, or the remote machine IP address). Issue the following command from terminal window:</p>
<pre><code class="lang-shell">docker context create my-remote-docker-machine --docker &quot;host=ssh://username@host:port&quot;
</code></pre>
<p>Always include the user name in the Docker endpoint address, even if it is the same as the local user name. If you omit the port, it defaults to 22.</p>
</li>
<li><p>Use the <strong>Command Palette</strong> (<code>kb(workbench.action.showCommands)</code>) to issue the <strong>Docker Context: Use</strong> command to activate the Docker context pointing to the remote machine. This command causes both VS Code and Docker CLI to use the remote machine context.</p>
</li>
<li><p>It is recommended to change the refresh rate to something longer than the default with the <code>docker.explorerRefreshInterval</code> setting. The connection over SSH is slow, and it can result in trying to refresh again before the previous refresh even finished. We recommend at least 3000 ms.</p>
</li>
</ol>
<h2 id="tips">Tips</h2>
<ul>
<li><p>The &quot;host&quot; part in the Docker endpoint string (<code>ssh://username@host:port</code>) must be either a globally-resolvable DNS machine name, or an IP address. Docker extension will not be able to use host aliases defined in the <a href="https://www.ssh.com/ssh/config/">SSH configuration file</a>.</p>
</li>
<li><p>Make sure the remote machine host key is already memorized <a href="https://www.ssh.com/ssh/key/#known-host-keys">in the known_hosts file</a>. The simplest way to ensure this is to connect to the machine via <code>ssh</code> client program (run <code>ssh username@host:port</code> from the command line). Upon first-time connection, the <code>ssh</code> program will display the host key and let you approve it, updating the <code>known_hosts</code> file automatically.</p>
</li>
<li><p>There is <a href="https://github.com/PowerShell/Win32-OpenSSH/issues/1263">an issue with ssh-keygen utility that comes with Windows 10 build 1909 and older</a> that prevents it from working properly with newer SSH daemons (for example, the one that comes with Ubuntu 20.04 LTS and newer). The workaround is to use ECDSA-type key, not RSA-type key, for the SSH connection. You can generate an ECDSA SSH key and add it to SSH agent with following commands:</p>
<pre><code class="lang-shell">ssh-keygen -t ecdsa -b 521
ssh-add id_ecdsa
</code></pre>
</li>
<li><p>Windows 10 build 1909 and older are affected by <a href="https://github.com/PowerShell/Win32-OpenSSH/issues/1234">an issue that prevents SSH from getting to your identities after Windows OS update</a>. The workaround is to add a dummy service entry to system configuration. Run the following from administrative command prompt window:</p>
<pre><code class="lang-shell">sc create sshd binPath=C:\Windows\System32\OpenSSH\ssh.exe
</code></pre>
</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &#0169; 2021 Jason Rose
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
