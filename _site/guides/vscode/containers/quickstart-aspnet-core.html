<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ASP.NET Core in a container | Fountain of Knowledge </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ASP.NET Core in a container | Fountain of Knowledge ">
    <meta name="generator" content="docfx 2.57.2.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="aspnet-core-in-a-container">ASP.NET Core in a container</h1>

<p>In this guide you will learn how to:</p>
<ul>
<li>Create a <code>Dockerfile</code> file describing a simple .NET Core service container.</li>
<li>Build, run, and verify the functionality of the service.</li>
<li>Debug the service running as a container.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Docker and the VS Code Docker extension must be installed as described on the <a href="overview.html#installation">overview</a>.</li>
<li>For .NET development, install <a href="https://dotnet.microsoft.com/download">.NET Core SDK</a>.</li>
<li>Microsoft <a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp">C# for Visual Studio Code</a> extension.</li>
</ul>
<h2 id="create-a-net-core-web-api-project">Create a .NET Core Web API project</h2>
<ol>
<li><p>Create a folder for the project.</p>
</li>
<li><p>Open developer command prompt in the project folder and initialize the project:</p>
<pre><code class="lang-bash">dotnet new webapi --no-https
</code></pre>
</li>
</ol>
<h2 id="add-docker-files-to-the-project">Add Docker files to the project</h2>
<ol>
<li><p>Open the project folder in VS Code.</p>
</li>
<li><p>Wait for the C# extension to prompt you to add required assets for build and debug, and choose <strong>Yes</strong>. You can also open the Command Palette (<code>kb(workbench.action.showCommands)</code>) and use the <strong>.NET: Generate Assets for Build and Debug</strong> command.</p>
</li>
<li><p>Open Command Palette (<code>kb(workbench.action.showCommands)</code>) and use <strong>Docker: Add Docker Files to Workspace...</strong> command:</p>
<p><img src="images/quickstarts/aspnetcore-add-dotnet.png" alt="Add Dockerfile to a .NET project"></p>
</li>
<li><p>Use <strong>.NET: ASP.NET Core</strong> when prompted for application platform.</p>
</li>
<li><p>Choose <strong>Windows</strong> or <strong>Linux</strong> when prompted to choose the operating system.</p>
<blockquote>
<p>Windows is only applicable if your Docker installation is configured to use Windows containers.</p>
</blockquote>
</li>
<li><p>You will be asked if you want to add Docker Compose files. We will not use Docker Compose in this tutorial, so both &quot;Yes&quot; and &quot;No&quot; answers are fine.</p>
</li>
<li><p>Change the port for application endpoint to <code>5000</code>.</p>
</li>
<li><p><code>Dockerfile</code> and <code>.dockerignore</code> files are added to the workspace.</p>
<p>The extension will also create a set of <strong>VS Code tasks</strong> for building and running the container (in both debug- and release configuration, four tasks in total), and a <strong>debugging configuration</strong> for launching the container in debug mode.</p>
</li>
</ol>
<h2 id="build-the-application">Build the application</h2>
<ol>
<li><p>Open terminal prompt (<code>kb(workbench.action.terminal.toggleTerminal)</code>).</p>
</li>
<li><p>Issue <code>dotnet build</code> command to build the application:</p>
<pre><code class="lang-output">~/code/scratch/netcorerest$ dotnet build
Microsoft (R) Build Engine version 16.3.0+0f4c62fea for .NET Core
Copyright (C) Microsoft Corporation. All rights reserved.

Restore completed in 18.97 ms for ~/code/scratch/netcorerest/netcorerest.csproj.
netcorerest -&gt; ~/code/scratch/netcorerest/bin/Debug/netcoreapp3.0/netcorerest.dll

 Build succeeded.
     0 Warning(s)
     0 Error(s)
</code></pre>
</li>
</ol>
<h2 id="add-an-environment-variable-to-the-image">Add an environment variable to the image</h2>
<p>You can use the Docker extension to author Docker files. The extension provides completions and contextual help. To see these capabilities add an environment variable to your service image by following these:</p>
<ol>
<li><p>Open the <code>Dockerfile</code> file.</p>
</li>
<li><p>Use <code>ENV</code> instruction to add an environment variable to the service container image. The instruction should be placed in the <code>base</code> stage of the <code>Dockerfile</code> (the first stage in the file). Set the <code>ASPNETCORE_URLS</code> variable to <code>http://*:5000</code>:</p>
<p><img src="images/quickstarts/aspnetcore-intellisense-env.png" alt="Add an environment variable to Docker image"></p>
<p>Note how the Docker extension lists all available Dockerfile instructions and describes the syntax.</p>
<blockquote>
<p>The Docker extension uses the <code>base</code> stage of the <code>Dockerfile</code> to create a debug version of the container image for your service. Put the <code>ASPNETCORE_URLS</code> environment variable definition in the <code>base</code> stage to have this variable available in both debug and release versions of the container image.</p>
</blockquote>
</li>
<li><p>Save the <code>Dockerfile</code> file.</p>
</li>
</ol>
<h2 id="build-the-image">Build the image</h2>
<ol>
<li><p>Open Command Palette (<code>kb(workbench.action.showCommands)</code>) and issue <strong>Docker Images: Build Image...</strong> command.</p>
</li>
<li><p>Open Docker Explorer and verify that the new image is visible in the Images tree:</p>
<p><img src="images/quickstarts/aspnetcore-verify-image.png" alt="Verify Docker image exists"></p>
</li>
</ol>
<h2 id="test-the-service-container">Test the service container</h2>
<ol>
<li><p>Right-click on the image built in previous step and choose <strong>Run</strong> or <strong>Run Interactive</strong>. The container should start and you should be able to see it in the &quot;Containers&quot; pane of the Docker Explorer:</p>
<p><img src="images/quickstarts/aspnetcore-running-container.png" alt="Running service container"></p>
</li>
<li><p>Open the web browser and navigate to <a href="http://localhost:5000/WeatherForecast">http://localhost:5000/WeatherForecast</a>. You should see weather data in JSON format, similar to following:</p>
<pre><code class="lang-jsonc">[
    {&quot;date&quot;:&quot;2019-11-07T23:31:57.0527092+00:00&quot;,&quot;temperatureC&quot;:4,&quot;temperatureF&quot;:39,&quot;summary&quot;:&quot;Bracing&quot;},
    {&quot;date&quot;:&quot;2019-11-08T23:31:57.0539243+00:00&quot;,&quot;temperatureC&quot;:-19,&quot;temperatureF&quot;:-2,&quot;summary&quot;:&quot;Freezing&quot;},
    {&quot;date&quot;:&quot;2019-11-09T23:31:57.0539269+00:00&quot;,&quot;temperatureC&quot;:2,&quot;temperatureF&quot;:35,&quot;summary&quot;:&quot;Freezing&quot;},
    {&quot;date&quot;:&quot;2019-11-10T23:31:57.0539275+00:00&quot;,&quot;temperatureC&quot;:-4,&quot;temperatureF&quot;:25,&quot;summary&quot;:&quot;Freezing&quot;},
    {&quot;date&quot;:&quot;2019-11-11T23:31:57.053928+00:00&quot;,&quot;temperatureC&quot;:9,&quot;temperatureF&quot;:48,&quot;summary&quot;:&quot;Bracing&quot;}
 ]
</code></pre>
<blockquote>
<p>By default Docker will assign a randomly chosen <strong>host port</strong> to a port exposed by a container (the <strong>container port</strong>). In our application the exposed (container) port is 5000. When you issue <strong>Run</strong> command for an image, VS Code will try to use the same port number for the host port and container port. This makes it easy to remember which port to use to communicate with the container, but it won't work if the host port is already in use.</p>
<p>If you cannot see the data from the container in your browser, make sure there are no errors reported by the <code>docker run</code> command (look at the command output in the terminal window). You can also verify which host port is using by the container by right-clicking the container in the Docker Explorer and choosing <strong>Inspect</strong>. This will open a JSON document that describes the container in detail. Search for <code>PortBindings</code> element, for example:</p>
<pre><code class="lang-jsonc">&quot;PortBindings&quot;: {
  &quot;5000/tcp&quot;: [
    {
      &quot;HostIp&quot;: &quot;&quot;,
      &quot;HostPort&quot;: &quot;5000&quot;
    }
  ]
},
</code></pre>
</blockquote>
</li>
<li><p>When done testing, right-click the container in the Docker Explorer and choose <strong>Stop</strong>.</p>
</li>
</ol>
<h2 id="debug-in-container">Debug in container</h2>
<p>When Docker files were added to the application, the Docker extension also added a <strong>VS Code debugger configuration</strong> for debugging the service when it is running inside a container. The extension will automatically detect the protocol and port that the service is using and point the browser to the service, but we need to tell it what URL path to use.</p>
<ol>
<li><p>Set a breakpoint at the beginning of the code for the <code>Get()</code> method of the <code>Controllers/WeatherForecastController.cs</code> file.</p>
</li>
<li><p>Open <code>.vscode/launch.json</code> file and find <code>Docker .NET Core Launch</code> debug configuration.</p>
</li>
<li><p>Add <code>dockerServerReadyAction</code> to <code>Docker .NET Core Launch</code> configuration:</p>
<pre><code class="lang-json">&quot;dockerServerReadyAction&quot;: {
    &quot;uriFormat&quot;: &quot;%s://localhost:%s/WeatherForecast&quot;
}
</code></pre>
</li>
<li><p>Make sure the configuration is selected as active:</p>
<p><img src="images/quickstarts/aspnetcore-debug-configuration.png" alt="Selected Docker debug configuration"></p>
</li>
<li><p>Start debugging (<code>kb(workbench.action.debug.start)</code>).</p>
<ul>
<li>The debug version of the service container builds and starts.</li>
<li>The browser opens to request a new weather forecast.</li>
<li>The breakpoint in the <code>WeatherForecastController</code> is hit.</li>
</ul>
</li>
</ol>
<p>You can use specific port on the host by changing the Docker run options used by <code>docker-run: debug</code> task (defined in <code>.vscode/tasks.json</code> file). For example, if you want to use the same port (5000) to expose the service, the <code>docker-run: debug</code> task definition would look like this:</p>
<pre><code class="lang-json"> {
    &quot;type&quot;: &quot;docker-run&quot;,
    &quot;label&quot;: &quot;docker-run: debug&quot;,
    &quot;dependsOn&quot;: [
        &quot;docker-build: debug&quot;
    ],
    &quot;dockerRun&quot;: {
        &quot;ports&quot;: [
            { &quot;hostPort&quot;: 5000, &quot;containerPort&quot;: 5000 }
        ]
    },
    &quot;netCore&quot;: {
        &quot;appProject&quot;: &quot;${workspaceFolder}/netcorerest.csproj&quot;,
        &quot;enableDebugging&quot;: true
    }

</code></pre>
<h2 id="next-steps">Next steps</h2>
<p>You're done! Now that your container is ready, you may want to:</p>
<ul>
<li><a href="debug-netcore.html">Learn about debugging .NET Core in a container</a></li>
<li><a href="reference.html">Customize your Docker build and run tasks</a></li>
<li><a href="app-service.html">Deploy a containerized app to Azure App Service</a></li>
<li><a href="docker-compose.html">Learn about using Docker Compose</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &#0169; 2021 Jason Rose
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
